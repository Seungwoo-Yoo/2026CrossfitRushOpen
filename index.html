<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 Rush Throwdown Leader Board - Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans KR', sans-serif; background-color: #111827; color: #d1d5db; }
        .tab { transition: all 0.2s ease-in-out; }
        .tab.active { color: #facc15; border-color: #facc15; }
        .loader { border: 4px solid #4b5563; border-top: 4px solid #facc15; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .details-row.hidden, #wod-content.hidden { display: none; }
        
        /* ğŸ’¡ í•˜ì´ë¼ì´íŠ¸ ë° ë­í‚¹ ìŠ¤íƒ€ì¼ */
        .highlight { background-color: #10b981 !important; color: #ffffff !important; font-weight: 700 !important; }
        .border-gold { border-left: 4px solid #FFD700; }
        .border-silver { border-left: 4px solid #C0C0C0; }
        .border-bronze { border-left: 4px solid #CD7F32; }
        
        /* íŒ€ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
        .team-icon {
            width: 24px; height: 24px; border-radius: 50%; object-fit: cover;
            margin-left: 6px; vertical-align: middle; display: inline-block;
        }

        /* ğŸ¨ Total íƒ­ ì „ìš© ìŠ¤íƒ€ì¼ (ì´ë¯¸ì§€ ë°°ê²½ + í…Œì´ë¸” ìœ„ì¹˜) */
        .total-wrapper {
            position: relative; width: 100%; max-width: 600px; margin: 0 auto;
            border-radius: 12px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
        .total-bg-image { width: 100%; display: block; }
        .total-table-container {
            position: absolute;
            /* ğŸ’¡ í¬ìŠ¤í„° ìœ„ í…Œì´ë¸” ìœ„ì¹˜ ì¡°ì • (í•„ìš”ì‹œ ì—¬ê¸° ìˆ«ì ë³€ê²½) */
            bottom: 8%; left: 10%; width: 80%; height: 40%;
            overflow-y: auto; background: rgba(0, 0, 0, 0.7);
            border-radius: 8px; padding: 5px;
        }
        .total-table-container::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-yellow-300 mb-2">
               2025 Rush Throwdown Leader Board
           </h1>
            <h2 id="main-title" class="text-2xl sm:text-2xl font-semibold text-white mb-4">"í¬ë¡œìŠ¤í•ì— ë¯¸ì¹œ ìš°ë¦¬ë“¤ì˜ ì”ì¹˜ë‚ " </h2>
            <p class="text-md sm:text-lg text-gray-400 mt-2">
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSdWS7EA9ojFB_DZ1Lnjo3pLt63SSgy6t6kh2Zh86tSQYuLskQ/viewform?usp=header" target="_blank" class="inline-flex items-center gap-2 px-2.5 py-1 bg-gray-800 hover:bg-gray-700 rounded-lg text-white text-xs font-medium transition-colors border border-gray-600">
                   ğŸ‘† ì‚¬ì´íŠ¸ ì œëª© ë°”ê¾¸ê¸° ë§í¬ / íŒ€ì›ì˜ ì‘ì› ë©”ì„¸ì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!
                </a>
            </p>
            <p class="text-md sm:text-lg text-gray-400 mt-2">
                <a href="https://photos.app.goo.gl/3t1rAPziQeKiFe4A7" target="_blank" class="inline-flex items-center gap-2 px-2.5 py-1 bg-gray-800 hover:bg-gray-700 rounded-lg text-white text-xs font-medium transition-colors border border-gray-600">
                   ğŸ“¸ 2025 Rush Throwdown ì‚¬ì§„ ì•¨ë²” ê³µìœ  ë° êµ¬ê²½ "Click!"
                </a>
            </p>
            
        </header>
        <div class="border-b border-gray-700 mb-4">
            <nav class="-mb-px flex flex-wrap justify-center space-x-2 sm:space-x-4" aria-label="Tabs">
                <button data-tab="event1" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm sm:text-base border-transparent text-gray-400 hover:text-white hover:border-gray-300">EVENT 1</button>
                <button data-tab="event2" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm sm:text-base border-transparent text-gray-400 hover:text-white hover:border-gray-300">EVENT 2</button>
                <button data-tab="event3" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm sm:text-base border-transparent text-gray-400 hover:text-white hover:border-gray-300">EVENT 3</button>
                <button data-tab="event4" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm sm:text-base border-transparent text-gray-400 hover:text-white hover:border-gray-300">EVENT 4</button>
                <button data-tab="timetable" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm sm:text-base border-transparent text-gray-400 hover:text-white hover:border-gray-300">TIMETABLE</button>
                <button data-tab="total" class="tab activae whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm sm:text-base border-transparent text-gray-400 hover:text-white hover:border-gray-300">TOTAL</button>
            </nav>
        </div>

        <div id="division-tabs" class="flex justify-center items-center gap-4 mb-6 hidden">
             <button data-division="Elite" class="tab active bg-gray-700/50 text-white font-bold py-2 px-4 rounded-full text-xs sm:text-sm">Elite Division</button>
        </div>

        <div id="wod-section" class="my-6 text-center">
            <button id="wod-toggle-button" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-full text-sm transition-colors duration-200">
                WOD DETAILS
            </button>
            
            <div id="wod-heat-selectors" class="flex flex-wrap justify-center gap-2 mt-4 hidden">
                </div>

            <div id="wod-content" class="hidden mt-4 p-4 bg-gray-800 rounded-lg text-left whitespace-pre-wrap max-w-2xl mx-auto">
            </div>
        </div>

        <div id="status" class="h-8 flex items-center justify-center text-sm text-gray-400 mb-4"></div>
        <div id="tableContainer" class="overflow-x-auto"></div>
    </div>

    <script>
        // --- âš ï¸ ì£¼ìµœì ì„¤ì • ë¶€ë¶„ âš ï¸ ---
        const API_KEY = 'AIzaSyDVAAXL9Tfcqq_7RsKIVhjBZgboDCved5g'; 
        const SPREADSHEET_ID = '18utoWLAV5n2Wknu-LdgS5rKLVdCQK0XuSrB42D_0RZw'; 
        
        // ğŸ–¼ï¸ í¬ìŠ¤í„° ì´ë¯¸ì§€ URL (ê¹ƒí—ˆë¸Œ ì´ë¯¸ì§€ ì£¼ì†Œë¡œ ê¼­ êµì²´!)
        const TOTAL_POSTER_URL = "https://raw.githubusercontent.com/Seungwoo-Yoo/2025RushThrowdown/main/images/total_poster.png";
        const SLOGAN_RANGE = "'Settings'!B4";
        const SHEET_DATA_MAP = {
            event1: {
                Elite: { range: "'ê²°ê³¼ì§€'!A3:C6", type: 'standard', wodRange: "'ê²°ê³¼ì§€'!A101" },
            },
            event2: {
                Elite: { range: "'ê²°ê³¼ì§€'!F3:L29", type: 'expandable', visibleCols: 4, wodRange: "'ê²°ê³¼ì§€'!B101" },
            },
            event3: {
                // ğŸ’¡ [ìˆ˜ì •] C101ë¶€í„° C112ê¹Œì§€ (12ê°œ) í•œ ë²ˆì— ê°€ì ¸ì˜¤ê¸°
                Elite: { range: "'ê²°ê³¼ì§€'!N3:W16", type: 'expandable_ranked', visibleCols: 4, wodRange: "'ê²°ê³¼ì§€'!C101:C112" },
            },
            event4: {
                // ğŸ’¡ [ìˆ˜ì •] D101ë¶€í„° D104ê¹Œì§€ (4ê°œ) í•œ ë²ˆì— ê°€ì ¸ì˜¤ê¸°
                Elite: { range: "'ê²°ê³¼ì§€'!N21:W26", type: 'expandable_ranked', visibleCols: 4, wodRange: "'ê²°ê³¼ì§€'!D101:D104" },
            },
            timetable: { Elite: { range: "'timetable'!A1:F25", type: 'timetable', wodRange: null, highlightRange: "'timetable'!G1" } },
            total: { 
                Elite: { 
                    range: "'ê²°ê³¼ì§€'!A40:G43", 
                    type: 'total_special', // Total íƒ­ì€ íŠ¹ë³„ ì²˜ë¦¬
                    visibleCols: 3, 
                    hideSwitchRange: "'Settings'!B1" 
                } 
            },
        };
        
        // íŒ€ ì´ë¯¸ì§€ ì„¤ì •
        const TEAM_IMAGE_MAP = {
            "Team Adam": "https://raw.githubusercontent.com/Seungwoo-Yoo/2025RushThrowdown/main/images/adam.png",
            "Team Stone": "https://raw.githubusercontent.com/Seungwoo-Yoo/2025RushThrowdown/main/images/Stone.png",
            "Team Yeonking": "https://raw.githubusercontent.com/Seungwoo-Yoo/2025RushThrowdown/main/images/yeonking.png",
        };
        
        const getTeamImageHtml = (teamName) => {
            const url = TEAM_IMAGE_MAP[teamName.trim()];
            return url ? `<img src="${url}" alt="${teamName} icon" class="team-icon">` : '';
        };

        const tableContainer = document.getElementById('tableContainer');
        const statusDiv = document.getElementById('status');
        const wodSection = document.getElementById('wod-section');
        const wodToggleButton = document.getElementById('wod-toggle-button');
        const wodContent = document.getElementById('wod-content');
        const REFRESH_INTERVAL = 15000;
        let currentEvent = 'total';
        let currentDivision = 'Elite';

        document.addEventListener('DOMContentLoaded', () => {
            if (!API_KEY || API_KEY.length < 10) { displayError('âš ï¸ API í‚¤ í™•ì¸ í•„ìš”'); return; }
            
            if (currentEvent === 'total' || currentEvent === 'timetable') {
                wodSection.style.display = 'none';
            }

            initializeTabs();
            
            // ğŸ’¡ ì²˜ìŒì— ìŠ¬ë¡œê±´ í•œë²ˆ ê°€ì ¸ì˜¤ê¸°
            fetchSlogan(); 
            fetchAndDisplayData();
            
            setInterval(() => {
                fetchAndDisplayData();
                fetchSlogan(); // ğŸ’¡ ì£¼ê¸°ì ìœ¼ë¡œ ìŠ¬ë¡œê±´ë„ ê°±ì‹  (ì‹¤ì‹œê°„ ë³€ê²½ ë°˜ì˜)
            }, REFRESH_INTERVAL);
        });

        function initializeTabs() {
            const mainTabs = document.querySelectorAll('button[data-tab]');
            mainTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    currentEvent = tab.dataset.tab;
                    wodSection.style.display = (currentEvent === 'timetable' || currentEvent === 'total') ? 'none' : 'block';
                    wodContent.classList.add('hidden'); 
                    mainTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    fetchAndDisplayData();
                });
            });
            wodToggleButton.addEventListener('click', () => wodContent.classList.toggle('hidden'));
        }

        async function fetchSlogan() {
            try {
                const data = await fetchData(SLOGAN_RANGE);
                if (data && data[0] && data[0][0]) {
                    const newTitle = data[0][0];
                    // 1. í™”ë©´ì˜ í° ì œëª© ë°”ê¾¸ê¸°
                    const titleElement = document.getElementById('main-title');
                    if (titleElement) titleElement.textContent = newTitle;
                    
                    // 2. ì¸í„°ë„· ë¸Œë¼ìš°ì € íƒ­ ì´ë¦„ë„ ê°™ì´ ë°”ê¾¸ê¸° (ì„¼ìŠ¤!)
                    document.title = newTitle;
                }
            } catch (error) {
                console.error("ìŠ¬ë¡œê±´ ë¡œë”© ì‹¤íŒ¨:", error);
            }
        }

        async function fetchAndDisplayData() {
            showLoading();
            const config = SHEET_DATA_MAP[currentEvent]?.Elite;
            if (!config) return;

            // Total ìˆ¨ê¹€ ì²˜ë¦¬
            if (currentEvent === 'total' && config.hideSwitchRange) {
                try {
                    const hideRes = await fetchData(config.hideSwitchRange);
                    if (hideRes?.[0]?.[0]?.toLowerCase() === 'o') { displayAnnouncement("ì‹œìƒì‹ë•Œ ê³µê°œ ë©ë‹ˆë‹¤!"); return; }
                } catch (e) { console.error(e); }
            }

            try {
                const [data, wodData, hlData] = await Promise.all([
                    fetchData(config.range),
                    config.wodRange ? fetchData(config.wodRange) : null,
                    config.highlightRange ? fetchData(config.highlightRange) : null
                ]);

                if (data) {
                    if (config.type === 'timetable') {
                        let hlRow = hlData?.[0]?.[0] ? parseInt(hlData[0][0]) : null;
                        renderTimetable(data, hlRow);
                    } else {
                        renderTable(data, config);
                    }
                } else displayError('ë°ì´í„° ì—†ìŒ');

                // ğŸ’¡ [WOD íˆíŠ¸ ì„ íƒ ê¸°ëŠ¥ ë¡œì§]
                const selectorDiv = document.getElementById('wod-heat-selectors');
                
                if (wodData && wodData.length > 0) {
                    // Event 3 ë˜ëŠ” 4ì²˜ëŸ¼ ë°ì´í„°ê°€ ì—¬ëŸ¬ ì¤„(íˆíŠ¸ë³„)ë¡œ ì˜¨ ê²½ìš°
                    if (currentEvent === 'event3' || currentEvent === 'event4') {
                        selectorDiv.innerHTML = ''; // ê¸°ì¡´ ë²„íŠ¼ ì´ˆê¸°í™”
                        selectorDiv.classList.remove('hidden'); // ë²„íŠ¼ ì˜ì—­ ë³´ì—¬ì£¼ê¸°
                        
                        // ê¸°ë³¸ê°’: ì²« ë²ˆì§¸ íˆíŠ¸ ë‚´ìš© ë³´ì—¬ì£¼ê¸°
                        if(!selectorDiv.hasAttribute('data-selected')) {
                             wodContent.textContent = wodData[0][0] || 'ë‚´ìš© ì—†ìŒ';
                        }

                        // ë²„íŠ¼ ë§Œë“¤ê¸° ë°˜ë³µë¬¸
                        wodData.forEach((row, index) => {
                            const heatNum = index + 1;
                            const eventNum = (currentEvent === 'event3') ? '3' : '4';
                            const btnLabel = `${eventNum}-${heatNum}`; // ì˜ˆ: 3-1, 3-2
                            
                            const btn = document.createElement('button');
                            btn.className = "px-3 py-1 text-xs font-bold rounded-full border border-gray-600 text-gray-300 hover:bg-yellow-600 hover:text-white hover:border-transparent transition-all";
                            btn.textContent = btnLabel;
                            
                            // ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘
                            btn.onclick = () => {
                                // ëª¨ë“  ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
                                Array.from(selectorDiv.children).forEach(b => {
                                    b.classList.remove('bg-yellow-500', 'text-white', 'border-transparent');
                                    b.classList.add('text-gray-300', 'border-gray-600');
                                });
                                // í´ë¦­ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê°•ì¡°
                                btn.classList.add('bg-yellow-500', 'text-white', 'border-transparent');
                                btn.classList.remove('text-gray-300', 'border-gray-600');
                                
                                // ë‚´ìš© ê°ˆì•„ë¼ìš°ê¸°
                                wodContent.textContent = row[0] || 'ë‚´ìš© ì—†ìŒ';
                                wodContent.classList.remove('hidden'); // ë‚´ìš©ì°½ ì—´ê¸°
                                selectorDiv.setAttribute('data-selected', 'true'); // ì„ íƒë¨ í‘œì‹œ
                            };

                            // ì²« ë²ˆì§¸ ë²„íŠ¼ì€ ìë™ìœ¼ë¡œ ì„ íƒëœ ìƒíƒœë¡œ ì‹œì‘ (ì›í•˜ë©´ ì£¼ì„ í•´ì œ)
                            // if (index === 0 && !selectorDiv.hasAttribute('data-selected')) btn.click();
                            
                            selectorDiv.appendChild(btn);
                        });

                    } else {
                        // Event 1, 2 (ë‹¨ì¼ ë‚´ìš©)
                        selectorDiv.classList.add('hidden');
                        wodContent.textContent = wodData[0][0];
                    }
                }

                updateStatus(`ì—…ë°ì´íŠ¸: ${new Date().toLocaleTimeString()}`);
            } catch(error) { displayError(`ì˜¤ë¥˜: ${error.message}`); }
        }
        
        async function fetchData(range) {
            const res = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(range)}?key=${API_KEY}`);
            const data = await res.json();
            if (!res.ok) throw new Error(data.error?.message);
            return data.values || null;
        }

        // --- âš™ï¸ ë©”ì¸ ë Œë”ë§ ìŠ¤ìœ„ì¹˜ ---
        function renderTable(data, config) {
            if (config.type === 'total_special') {
                renderTotalSpecial(data, config.visibleCols);
            } else if (config.type === 'expandable_ranked') {
                renderExpandableRankedTable(data, config.visibleCols);
            } else if (config.type === 'expandable') {
                renderExpandableTable(data, config.visibleCols);
            } else {
                renderStandardTable(data);
            }
        }

        // ğŸ† [ìµœì¢… ì™„ì„±] 2ì—´ ì—¬ë°±ì„ ì‚´ì§(pl-3) ì¤˜ì„œ ë‹µë‹µí•¨ í•´ì†Œ!
        function renderTotalSpecial(data, visibleCols) {
            tableContainer.innerHTML = '';
            
            const wrapper = document.createElement('div'); wrapper.className = 'total-wrapper';
            const img = document.createElement('img'); img.src = TOTAL_POSTER_URL; img.className = 'total-bg-image';
            const tableBox = document.createElement('div'); tableBox.className = 'total-table-container';

            const table = document.createElement('table');
            table.className = "min-w-full divide-y divide-gray-600 table-fixed";
            const tbody = document.createElement('tbody');

            const allHeaders = data[0];

            for (let i = 1; i < data.length; i++) {
                const rowData = data[i];
                if (!rowData.some(c => c && c.trim() !== '')) continue;

                const rank = rowData[0] || '-';
                const teamName = rowData[1] || 'Team';
                const score = rowData[2] || '0';

                const tr = document.createElement('tr');
                tr.className = "cursor-pointer hover:bg-white/10 border-b border-gray-700/50";
                
                let rankIcon = rank;
                if(rank=='1') rankIcon='ğŸ¥‡'; else if(rank=='2') rankIcon='ğŸ¥ˆ'; else if(rank=='3') rankIcon='ğŸ¥‰';
                
                const teamImgTag = getTeamImageHtml(teamName);

                tr.innerHTML = `
                    <td class="py-2 sm:py-3 text-center font-bold text-white w-[12%] p-0" 
                        style="font-size: clamp(12px, 3.5vw, 20px);">
                        ${rankIcon}
                    </td>
                    
                    <td class="py-2 sm:py-3 text-gray-200 w-[68%] pl-10 sm:pl-12 whitespace-nowrap" 
                        style="font-size: clamp(11px, 3.5vw, 18px);">
                        
                        <div class="flex items-center gap-0.5 sm:gap-2">
                            <span class="font-medium tracking-tighter sm:tracking-normal">
                                ${teamName}
                            </span>
                            <span class="flex-shrink-0">
                                ${teamImgTag}
                            </span>
                        </div>
                    </td>
                    
                    <td class="py-2 sm:py-3 text-right font-extrabold text-yellow-400 w-[20%] pr-2 sm:pr-4" 
                        style="font-size: clamp(11px, 3.5vw, 20px);">
                        ${score}<span class="text-[0.7em] font-normal text-gray-400 ml-0.5">PTS</span>
                    </td>
                `;

                // ìƒì„¸ ì •ë³´ (ìˆ¨ê¹€)
                const detailsRow = document.createElement('tr'); detailsRow.className = "hidden details-row bg-black/70";
                const detailsCell = document.createElement('td'); detailsCell.colSpan = 3; detailsCell.className = "p-3 sm:p-4 text-gray-300";
                
                let detailsHTML = '<ul class="space-y-1 sm:space-y-2" style="font-size: clamp(11px, 3vw, 16px);">';
                for(let k=3; k<rowData.length; k++) {
                    const header = allHeaders[k] || `Detail ${k}`;
                    const val = rowData[k] || '-';
                    detailsHTML += `<li><span class="text-gray-500 font-medium">${header}:</span> <span class="text-white ml-2">${val}</span></li>`;
                }
                detailsHTML += '</ul>';
                detailsCell.innerHTML = detailsHTML;
                detailsRow.appendChild(detailsCell);

                tr.addEventListener('click', () => {
                    const isHidden = detailsRow.classList.contains('hidden');
                    tbody.querySelectorAll('.details-row').forEach(r => r.classList.add('hidden'));
                    if(isHidden) {
                        detailsRow.classList.remove('hidden');
                        setTimeout(() => {
                            detailsRow.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }, 100);
                    }
                });
                tbody.append(tr, detailsRow);
            }
            table.appendChild(tbody); tableBox.appendChild(table); wrapper.append(img, tableBox); tableContainer.appendChild(wrapper);
        }

        // 2. Expandable Ranked (Event 3, 4)
        function renderExpandableRankedTable(data, visibleCols) {
            tableContainer.innerHTML = '';
            const table = document.createElement('table'); table.className = "min-w-full divide-y divide-gray-700";
            const thead = document.createElement('thead'); thead.className = "bg-gray-800";
            const headerRow = document.createElement('tr');
            
            if (!data || !data.length) return;
            const allHeaders = data[0];
            const finalVisibleIndices = [0, 2, 4, 6].slice(0, visibleCols);
            const rankIndices = [1, 3, 5]; 
            const borderColIndices = [1, 2, 3]; 

            finalVisibleIndices.forEach(i => {
                const th = document.createElement('th'); th.className = "py-3.5 px-4 text-center text-sm font-semibold text-white";
                let content = allHeaders[i];
                const imgHtml = getTeamImageHtml(content);
                th.innerHTML = imgHtml ? `${content} ${imgHtml}` : content;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);

            const tbody = document.createElement('tbody'); tbody.className = "divide-y divide-gray-800";
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (!row.some(c => c && c.trim() !== '')) continue;
                
                const tr = document.createElement('tr');
                tr.className = `${(i%2===0)?'bg-white/5':'bg-transparent'} cursor-pointer hover:bg-white/10`;

                finalVisibleIndices.forEach((idx, colIndex) => {
                    const td = document.createElement('td'); td.className = "whitespace-nowrap px-4 py-4 text-sm text-center text-gray-300";
                    let content = row[idx] || '';
                    
                    const borderIdx = borderColIndices.indexOf(colIndex);
                    if (borderIdx !== -1 && borderIdx < rankIndices.length) {
                        const rank = row[rankIndices[borderIdx]];
                        if(rank=='1') { td.classList.add('border-gold'); content = 'ğŸ¥‡ '+content; }
                        else if(rank=='2') { td.classList.add('border-silver'); content = 'ğŸ¥ˆ '+content; }
                        else if(rank=='3') { td.classList.add('border-bronze'); content = 'ğŸ¥‰ '+content; }
                    }
                    td.textContent = content; tr.appendChild(td);
                });

                // ìƒì„¸ ì •ë³´
                const dRow = document.createElement('tr'); dRow.className = "hidden details-row";
                const dCell = document.createElement('td'); dCell.colSpan = visibleCols; dCell.className = "p-0";
                const dDiv = document.createElement('div'); dDiv.className = "bg-gray-800 p-4 text-left text-sm";
                let dHtml = '<div class="font-semibold text-white mb-2">ìƒì„¸ ì •ë³´</div><ul class="list-disc list-inside space-y-1">';
                [7, 8, 9].forEach(k => {
                    if(allHeaders[k]) dHtml += `<li><span class="font-semibold text-gray-400">${allHeaders[k]}:</span> <span class="text-white">${row[k]||'N/A'}</span></li>`;
                });
                dHtml += '</ul>'; dDiv.innerHTML = dHtml; dCell.appendChild(dDiv); dRow.appendChild(dCell);
                
                tr.addEventListener('click', () => {
                    const isHidden = dRow.classList.contains('hidden');
                    tbody.querySelectorAll('.details-row').forEach(r => r.classList.add('hidden'));
                    if(isHidden) dRow.classList.remove('hidden');
                });
                tbody.append(tr, dRow);
            }
            table.append(thead, tbody); tableContainer.appendChild(table);
        }

        // 3. Expandable (Event 2)
        function renderExpandableTable(data, visibleCols) {
            tableContainer.innerHTML = '';
            const table = document.createElement('table'); table.className = "min-w-full divide-y divide-gray-700";
            const thead = document.createElement('thead'); thead.className = "bg-gray-800";
            const hRow = document.createElement('tr');
            
            if(!data || !data.length) return;
            const headers = data[0].slice(0, visibleCols);
            headers.forEach(h => {
                const th = document.createElement('th'); th.className = "py-3.5 px-4 text-center text-sm font-semibold text-white";
                th.innerHTML = (currentEvent==='event2') ? `${h} ${getTeamImageHtml(h)}` : h;
                hRow.appendChild(th);
            });
            thead.appendChild(hRow);

            const tbody = document.createElement('tbody'); tbody.className = "divide-y divide-gray-800";
            for(let i=1; i<data.length; i++) {
                const row = data[i]; if(!row.some(c=>c&&c.trim())) continue;
                const tr = document.createElement('tr'); tr.className = `${(i%2===0)?'bg-white/5':'bg-transparent'} cursor-pointer hover:bg-white/10`;
                
                row.slice(0, visibleCols).forEach((cell, idx) => {
                    const td = document.createElement('td'); 
                    let cls = "px-4 py-4 text-sm text-center text-gray-300";
                    let txt = cell || '';
                    if (idx===0 && txt.includes('+')) { txt = txt.replace(/\s\+\s/g, '<br>+ '); cls+=" whitespace-normal"; }
                    else if (txt.includes('(')) {
                        const cut = txt.indexOf('(');
                        txt = `${txt.substring(0, cut)} <span class="whitespace-normal break-words">${txt.substring(cut)}</span>`;
                        cls+=" whitespace-normal break-words";
                    } else { cls+=" whitespace-nowrap"; }
                    td.className = cls; td.innerHTML = txt; tr.appendChild(td);
                });

                // ìƒì„¸ ì •ë³´
                const dRow = document.createElement('tr'); dRow.className="hidden details-row";
                const dCell = document.createElement('td'); dCell.colSpan=visibleCols; dCell.className="p-0";
                const dDiv = document.createElement('div'); dDiv.className="bg-gray-800 p-4 text-sm grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4";
                
                let dHtml = '';
                for(let k=visibleCols; k<row.length; k++) {
                    dHtml += `<div><span class="font-semibold text-gray-400">${data[0][k]}:</span> <span class="text-white">${row[k]||'N/A'}</span></div>`;
                }
                dDiv.innerHTML = dHtml; dCell.appendChild(dDiv); dRow.appendChild(dCell);
                
                tr.addEventListener('click', () => {
                    const isHidden = dRow.classList.contains('hidden');
                    tbody.querySelectorAll('.details-row').forEach(r => r.classList.add('hidden'));
                    if(isHidden) dRow.classList.remove('hidden');
                });
                tbody.append(tr, dRow);
            }
            table.append(thead, tbody); tableContainer.appendChild(table);
        }

        // 4. Timetable
        function renderTimetable(data, highlightRowNumber) {
            tableContainer.innerHTML = '';
            const table = document.createElement('table'); table.className = "min-w-full divide-y divide-gray-700 table-fixed";
            const thead = document.createElement('thead'); thead.className = "bg-gray-800";
            const hRow = document.createElement('tr');
            if(!data || !data.length) return;
            data[0].forEach(h => {
                const th = document.createElement('th'); th.className="py-3.5 px-4 text-center text-sm font-semibold text-white"; th.textContent=h; hRow.appendChild(th);
            });
            thead.appendChild(hRow);

            const tbody = document.createElement('tbody'); tbody.className = "divide-y divide-gray-800";
            for(let i=1; i<data.length; i++) {
                const row = data[i]; if(!row.some(c=>c&&c.trim())) continue;
                const tr = document.createElement('tr');
                const isHl = (i===highlightRowNumber);
                tr.className = `${(i%2===0)?'bg-white/5':'bg-transparent'} hover:bg-white/10 ${isHl?'highlight':''}`;
                
                row.forEach((cell, idx) => {
                    const td = document.createElement('td'); td.className=`px-2 py-4 text-sm text-center ${isHl?'text-white':'text-gray-300'} break-words`;
                    let txt = cell || '';
                    if(idx===0) txt = txt.replace(' ', '<br>');
                    if(idx===1) txt = txt.replace('-', '<br>');
                    td.innerHTML = txt; tr.appendChild(td);
                });
                tbody.appendChild(tr);
            }
            table.append(thead, tbody); tableContainer.appendChild(table);
        }

        // 5. Standard (Event 1)
        function renderStandardTable(data) {
            tableContainer.innerHTML = '';
            const table = document.createElement('table'); table.className = "min-w-full divide-y divide-gray-700";
            const thead = document.createElement('thead'); thead.className="bg-gray-800";
            const hRow = document.createElement('tr');
            if(!data || !data.length) return;
            data[0].forEach(h => {
                const th = document.createElement('th'); th.className="py-3.5 px-4 text-center text-sm font-semibold text-white"; th.textContent=h; hRow.appendChild(th);
            });
            thead.appendChild(hRow);

            const tbody = document.createElement('tbody'); tbody.className="divide-y divide-gray-800";
            for(let i=1; i<data.length; i++){
                const row = data[i]; if(!row.some(c=>c&&c.trim())) continue;
                const tr = document.createElement('tr'); tr.className=`${(i%2===0)?'bg-white/5':'bg-transparent'} hover:bg-white/10`;
                const rank = row[0]?String(row[0]).trim():'';
                
                row.forEach((cell, idx) => {
                    const td = document.createElement('td'); td.className="whitespace-nowrap px-4 py-4 text-sm text-center text-gray-300";
                    let content = cell||'';
                    if(idx===1) {
                        if(rank=='1') content = 'ğŸ¥‡ '+content;
                        else if(rank=='2') content = 'ğŸ¥ˆ '+content;
                        else if(rank=='3') content = 'ğŸ¥‰ '+content;
                        content += getTeamImageHtml(cell);
                        td.innerHTML = content;
                    } else td.textContent = content;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            }
            table.append(thead, tbody); tableContainer.appendChild(table);
        }

        function showLoading() { statusDiv.innerHTML = '<div class="loader mx-auto"></div>'; }
        function updateStatus(msg) { statusDiv.innerHTML = msg; }
        function displayError(msg) { statusDiv.innerHTML = `<span class="text-red-400">${msg}</span>`; wodSection.style.display='none'; }
        function displayAnnouncement(msg) { tableContainer.innerHTML = `<div class="p-10 text-center text-2xl text-white font-bold">${msg}</div>`; wodSection.style.display='none'; }
    </script>
</body>
</html>
